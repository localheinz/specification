language: php

sudo: false

env:
  global:
    - secure: "Izzl4auxeh4UKHXDsdyG7HQbx9RqQAce3FpQHZfLaPkcDDquTfSQBerPGPV+zDj4LtnD+mfFGPLNwlbcXUUAtafhhzwXxOiwdc5J7ViS97Kr6em23x6bSNBgYVL5SufsfSTKNcAsI4AO7wyQKWJIHwh84Sn0O4F/zn+En3nUgHLvPCw/LCFt66K5GXflJJCtcoYRuLEDJ4XQ4TxiVrdFhzpmLKpXB/gm5N2/Ryv77jbMymgCZ/6xy9jKYDyEIpqnXpZFj30IW5OFYJV2+D5ij9fj+m1/9XO3hU1V+8kQK09DD+sXo/GckLP+VAWMpLIaLaZ9lO9Fc4icytC27ZQ8Ros5EQEhrbN1sALo1IWuBRP3cLiwcXhsnfq9TjizhobRxVlLcndwCcUZeaDd7X5Jo65nIoe/1eDCkl3BTQp6NIAveazp6Le/4lSOy2KUhHSDPQxDR50ADScRxhSqrQRxNjVAeCR4mmTx5fMYJhCKyVQiSlYyqecBetl2pp6jCryCPj/bJThCWLkkgp5QC2g4OEY5d2mZNwirO0a5VsyvekqcxAn+0sfOxbqiym5aHYX5t8S9Q76ynl9Qz+rkjFKa7YSPSUtAdqckSufWxEDvY8J3By6sCkORAUkvWuKUVPvRO9yhU9KlEMDEOZ30bsmHlpqp4NZD7o2JFUF85tI5d4g="
    - secure: "YGucw2LcrMeY3yupvQwxE1TUZTJp5IqOGN5BmGxzUZ8qJsjN60dZ8zJExAEvclmDtm9Ru0Pk9+3abzP+pzem5bnQL1Az4D4aiJD7r1CEe1r24kajZFMtNRUtZyvjVQRtGwjPtAdMMZS3yug/zMfFUD061/BR/zTsC8Gnkm80jvF61B9VXhsI0GPTjbTGAYZ38TMrnI2xsu6Nuic6YJXCQ1HUeY+fyHbglueifIBuc4Fh08gTBYZPvZAflmbma6Be5UXTliHTMUGaIlJHLN5lmiwYuiu4IIY/FWCedWMj4PyW3oY1kxhSmVtOUQBr7z7l7xrW4JwXPu1vX/TMeXHLE89id/T79E96Viyi94rlPTfW0WMjbUQ9BjgGiUGlZaStJ9EiS0dSR+bwZYjufws3SJp9CLfNgzp2/cpNPwc+ixIEF4cKbBSSRPfgLG1n9YZNhfdSOfHN/IWefxaPPnK7UmXtVEC4cm+iAyHj5GE5UyLY+uF8fuF2K1lysFXQvV+fPfAopk1F5cKRf8/NhVi9DJZ9q8ioY8DBuzCamc/Ar+zq+fdz9LS/FPyK2Zt0bZ3f+yacelepzD7eRxH/sY0mrhsjRFoaFo/WQ7iDmrnVQUO8PyIACC3HJWZdBrPHtUJyOTSLlmrEQ0vU6H+SLxi4QzQT1iv5UpINEDsjh1ZU9NY="

matrix:
  include:
    - php: 7.0
      env: WITH_LOWEST=true
    - php: 7.0
      env: WITH_HIGHEST=true WITH_CS=true
    - php: 7.1
      env: WITH_LOWEST=true
    - php: 7.1
      env: WITH_HIGHEST=true WITH_COVERAGE=true

cache:
  directories:
    - $HOME/.composer/cache
    - $HOME/.php-cs-fixer

before_install:
  - source .travis/xdebug.sh
  - xdebug-disable
  - composer validate
  - composer config github-oauth.github.com $GITHUB_TOKEN

install:
  - if [[ "$WITH_LOWEST" == "true" ]]; then composer update --prefer-lowest; else composer install; fi

before_script:
  - mkdir -p $HOME/.php-cs-fixer

script:
  - if [[ "$WITH_CS" == "true" ]]; then vendor/bin/php-cs-fixer fix --config=.php_cs --diff --dry-run --verbose; fi
  - if [[ "$WITH_COVERAGE" == "true" ]]; then xdebug-enable; fi
  - if [[ "$WITH_COVERAGE" == "true" ]]; then vendor/bin/phpunit --configuration=test/Unit/phpunit.xml --coverage-clover=build/logs/clover.xml; else vendor/bin/phpunit --configuration=test/Unit/phpunit.xml; fi
  - if [[ "$WITH_COVERAGE" == "true" ]]; then xdebug-disable; fi
  - vendor/bin/phpunit --configuration=test/Integration/phpunit.xml

after_success:
  - if [[ "$WITH_COVERAGE" == "true" ]]; then vendor/bin/test-reporter --coverage-report=build/logs/clover.xml; fi

notifications:
  email: false
